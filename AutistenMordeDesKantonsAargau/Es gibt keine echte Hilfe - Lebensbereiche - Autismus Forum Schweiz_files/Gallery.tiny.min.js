var Gallery={};!function(){for(var e=0,t=["ms","moz","webkit","o"],a=0;a<t.length&&!window.requestAnimationFrame;++a)window.requestAnimationFrame=window[t[a]+"RequestAnimationFrame"],window.cancelRequestAnimationFrame=window[t[a]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,a){var i=(new Date).getTime(),n=Math.max(0,16-(i-e)),o=window.setTimeout(function(){t(i+n)},n);return e=i+n,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),Gallery.Album={},Gallery.Album.Dialog=Class.extend({_createdCallbacks:{},_descriptionError:{},_dialog:{},_dialogContainer:{},_saveCallbacks:{},_proxy:{},_titleError:{},_updatedCallbacks:{},_validationCallbacks:{},init:function(){},_cancel:function(){},_hideDescriptionError:function(){},_hideTitleError:function(){},_save:function(){},_showDialog:function(){},_showDescriptionError:function(){},_showTitleError:function(){},_success:function(){},registerCallback:function(){},show:function(){}}),Gallery.Album.InlineEditor=WCF.InlineEditor.extend({_dialog:{},_permissions:{},_redirectURL:"",_sortImagesURL:"",_execute:function(){},_getPermission:function(){},_getTriggerElement:function(){},_registerAlbumDialogCallbacks:function(){},_setOptions:function(){},_updateAlbumData:function(){},_validate:function(){},getDialog:function(){},setPermission:function(){},setPermissions:function(){},setRedirectURL:function(){},setSortImagesURL:function(){},_callbacks:{},_dropdowns:{},_elements:{},_notification:{},_options:{},_proxy:{},_triggerElements:{},_updateData:{},init:function(){},_closeAll:function(){},registerCallback:function(){},_show:function(){},_validateCallbacks:function(){},_success:function(){},_updateState:function(){},_click:function(){},_executeCallback:function(){},_hide:function(){}}),Gallery.Album.Share=WCF.Message.Share.Content.extend({_albumID:0,init:function(e){this._albumID=e,this._super()},_click:function(e){e.preventDefault();var t=$(e.currentTarget),a=t.prop("href"),i=a.hashCode();if(void 0===this._cache[i]){var n=!1;null===this._dialog?(this._dialog=$("<div />").hide().appendTo(document.body),n=!0):this._dialog.empty();var o=$('<section class="section"><h2 class="sectionTitle"><label for="__sharePermalink">'+WCF.Language.get("wcf.message.share.permalink")+"</label></h2></section>").appendTo(this._dialog);$('<input type="text" id="__sharePermalink" class="long" readonly />').attr("value",a).appendTo(o),o=$('<section class="section"><h2 class="sectionTitle"><label for="__shareBBCode">'+WCF.Language.get("wcf.message.share.permalink.bbcode")+"</label></h2></section>").appendTo(this._dialog),$('<input type="text" id="__shareBBCode" class="long" readonly />').attr("value","[album]"+this._albumID+"[/album]").appendTo(o),this._cache[i]=this._dialog.html(),n?this._dialog.wcfDialog({title:WCF.Language.get("wcf.message.share")}):this._dialog.wcfDialog("open")}else this._dialog.html(this._cache[i]).wcfDialog("open");this._enableSelection()}}),Gallery.Album.SortableImageList=Class.extend({_albumID:0,_offset:0,_proxy:{},init:function(){},_loadMoreImages:function(){},_success:function(){}}),Gallery.Category={},Gallery.Category.MarkAllAsRead=Class.extend({_proxy:null,init:function(){this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)}),$(".markAllAsReadButton").click($.proxy(this._click,this))},_click:function(e){e.preventDefault(),this._proxy.setOption("data",{actionName:"markAllAsRead",className:"gallery\\data\\category\\GalleryCategoryAction"}),this._proxy.sendRequest()},_success:function(e,t,a){$(".nestedCategoryList").find(".badge.badgeUpdate").hide(),$(".galleryImageList .galleryNewImageBadge").hide(),$(".mainMenu .active .badge").hide(),elBySelAll(".pageMainMenuMobile .active",void 0,function(e){elBySelAll(".badge",e.closest(".menuOverlayItem"),elRemove)}),WCF.System.Event.fireEvent("com.woltlab.wcf.MainMenuMobile","updateButtonState")}}),Gallery.Image={},Gallery.Image.Browser=Class.extend({_dialog:{},_isOpen:!1,_redactor:{},init:function(){},open:function(){},_initImageBrowser:function(){},_insertBBCode:function(){},_domNodeInserted:function(){}}),Gallery.Image.Browser.Loader=Class.extend({_actionName:"",_cache:{},_imageBrowser:{},_list:{},_pagination:{},_pageNo:0,_pages:0,_previousPageNo:0,_proxy:{},init:function(){},_showPage:function(){},_getParameters:function(){},_loadItems:function(){},_success:function(){}}),Gallery.Image.Browser.AlbumList={},Gallery.Image.Browser.AlbumList.Loader=Gallery.Image.Browser.Loader.extend({init:function(){},_actionName:"",_cache:{},_imageBrowser:{},_list:{},_pagination:{},_pageNo:0,_pages:0,_previousPageNo:0,_proxy:{},_showPage:function(){},_getParameters:function(){},_loadItems:function(){},_success:function(){}}),Gallery.Image.Browser.ImageList={},Gallery.Image.Browser.ImageList.Loader=Gallery.Image.Browser.Loader.extend({init:function(){},_actionName:"",_cache:{},_imageBrowser:{},_list:{},_pagination:{},_pageNo:0,_pages:0,_previousPageNo:0,_proxy:{},_showPage:function(){},_getParameters:function(){},_loadItems:function(){},_success:function(){}}),Gallery.Image.Browser.Search={},Gallery.Image.Browser.Search.Handler=WCF.Search.Base.extend({_searchLoader:{},init:function(){},_keyUp:function(){},_queryServer:function(){},_getParameters:function(){},_success:function(){},_clearList:function(){},_callback:{},_caretAt:0,_className:"",_commaSeperated:!1,_delay:0,_excludedSearchValues:{},_itemCount:0,_itemIndex:0,_list:{},_oldSearchString:{},_proxy:{},_searchInput:{},_triggerLength:0,_timer:{},_blur:function(){},_keyDown:function(){},setDelay:function(){},_selectNextItem:function(){},_selectPreviousItem:function(){},_highlightSelectedElement:function(){},_selectElement:function(){},_getSearchString:function(){},_openDropdown:function(){},_handleEmptyResult:function(){},_createListItem:function(){},_executeCallback:function(){},addExcludedSearchValue:function(){},removeExcludedSearchValue:function(){}}),Gallery.Image.Browser.Search.Loader=Gallery.Image.Browser.Loader.extend({_searchString:"",init:function(){},handleSearchResult:function(){},_getParameters:function(){},_actionName:"",_cache:{},_imageBrowser:{},_list:{},_pagination:{},_pageNo:0,_pages:0,_previousPageNo:0,_proxy:{},_showPage:function(){},_loadItems:function(){},_success:function(){}}),Gallery.Image.Delete=WCF.Action.Delete.extend({_redirectURL:"",init:function(){},_success:function(){},_buttonSelector:"",_callback:{},_className:"",_containerSelector:"",_containers:{},_initElements:function(){},_click:function(){},_didTriggerEffect:function(){},_execute:function(){},_sendRequest:function(){},setCallback:function(){},triggerEffect:function(){}}),Gallery.Image.AlbumNavigation=Class.extend({_activeImage:null,_imageList:null,_side:"left",init:function(){this._activeImage=$(".gallerySidebarBoxImageNavigation").find("li.active"),this._imageList=$("#galleryAlbumImageNavigation"),"rtl"==WCF.Language.get("wcf.global.pageDirection")&&(this._side="right");var e=-this._activeImage.position().left+this._activeImage.outerWidth(!0),t=-this._activeImage.outerWidth(!0)*(this._imageList.children().length-3);e>0?e=0:e<t&&(e=t),this._imageList.css(this._side,e),e?e==t&&$(".galleryNavigationArrowNext").addClass("disabled").children(".pointer").removeClass("pointer"):$(".galleryNavigationArrowPrevious").addClass("disabled").children(".pointer").removeClass("pointer"),$(".galleryNavigationArrowPrevious").click($.proxy(this._showPreviousImages,this)),$(".galleryNavigationArrowNext").click($.proxy(this._showNextImages,this))},_showPreviousImages:function(e){var t=$(e.currentTarget);if(!$(e.currentTarget).hasClass("disabled")){for(var a=parseInt(this._imageList.css(this._side)),i=this._activeImage.outerWidth(!0),n=a+3*i;n>0;)n-=i;if(n!=a){var o=$(".galleryNavigationArrowNext");o.hasClass("disabled")&&(o.removeClass("disabled"),o.children(".icon").addClass("pointer"))}var s={};s[this._side]=n,this._imageList.animate(s,500,function(){n!=a+3*i&&(t.addClass("disabled"),t.children(".pointer").removeClass("pointer"))})}},_showNextImages:function(e){var t=$(e.currentTarget);if(!$(e.currentTarget).hasClass("disabled")){for(var a=parseInt(this._imageList.css(this._side)),i=this._activeImage.outerWidth(!0),n=a-3*i;n<-i*(this._imageList.children().length-3);)n+=i;if(n!=a){var o=$(".galleryNavigationArrowPrevious");o.hasClass("disabled")&&(o.removeClass("disabled"),o.children(".icon").addClass("pointer"))}var s={};s[this._side]=n,this._imageList.animate(s,500,function(){n!=a-3*i&&(t.addClass("disabled"),t.children(".pointer").removeClass("pointer"))})}}}),Gallery.Image.InlineEditor=WCF.InlineEditor.extend({_environment:"",_permissions:{},_redirectURL:"",_updateHandler:{},setRedirectURL:function(){},setUpdateHandler:function(){},_setOptions:function(){},_show:function(){},_hide:function(){},_toggleDropdown:function(){},_getTriggerElement:function(){},_validate:function(){},_execute:function(){},_updateImage:function(){},_updateState:function(){},_getPermission:function(){},setPermission:function(){},setPermissions:function(){},_callbacks:{},_dropdowns:{},_elements:{},_notification:{},_options:{},_proxy:{},_triggerElements:{},_updateData:{},init:function(){},_closeAll:function(){},registerCallback:function(){},_validateCallbacks:function(){},_success:function(){},_click:function(){},_executeCallback:function(){}}),Gallery.Image.Like=WCF.Like.extend({_getContainers:function(){return $(".galleryImageContainer")},_getObjectID:function(e){return this._containers[e].data("objectID")},_getWidgetContainer:function(e){return $("#imageButtonContainer")},_buildWidget:function(e,t,a,i,n){var o=this._getWidgetContainer(e);this._canLike&&(o.prepend(a).prepend(t),a.find("a").addClass("button"),t.find("a").addClass("button")),n&&(n.appendTo($(".galleryImageContainer")),n.addClass("messageFooterNote")),$(".galleryImageHeadline > h1").append(i)},_setActiveState:function(e,t,a){e=e.find(".button").removeClass("active"),t=t.find(".button").removeClass("active"),1==a?e.addClass("active"):-1==a&&t.addClass("active")},_addWidget:function(e,t){}}),Gallery.Image.Handler=Class.extend({_activeImageID:"",_callbacks:{},_dataHandlers:{},_errorMessage:{},_image:{},_imageContainer:{},_imageProcessor:{},_images:{},_initialData:{},_options:{},_proxy:{},_saveButton:{},_saveRequestCount:0,_scrollEffect:{},_thumbnailListContainer:{},_thumbnailAreaSelector:{},_uploadHandler:{},_uploadWarning:{},_maxUserImageCount:0,_maxDescriptionLength:0,_maxInputVars:0,_redirectURL:"",_tmpHash:"",_userImageCount:0,_overwriteDataButtons:null,_currentImageContainer:null,_currentVideoContainter:null,_video:null,videoLinkHandler:null,init:function(){},_toggleImage:function(){},_toggleVideo:function(){},_toggleVideoLink:function(){},_pauseVideo:function(){},_getImageIDs:function(){},_getRequestData:function(){},_handleSavedImageData:function(){},_overwriteData:function(){},_rotateImage:function(){},_save:function(){},_sendRequests:function(){},_showErrorMessage:function(){},_success:function(){},_didRotateImage:function(){},addDataHandler:function(){},addError:function(){},addImage:function(){},addInitialData:function(){},getActiveImage:function(){},getDataHandler:function(){},getDataHandlers:function(){},getActiveImageDataHandlers:function(){},getImage:function(){},getImageNode:function(){},getImageProcessor:function(){},getImages:function(){},registerCallback:function(){},removeDataHandler:function(){},removeImage:function(){},removeImageByClick:function(){},setActiveImage:function(){},addEditedImageData:function(){},setEditedImageData:function(){},setFirstImageActive:function(){},setUserImageCount:function(){},setUserUploadedVideoCount:function(){},setUserVideoLinkCount:function(){},_updateUploadInterface:function(){},getFreeImageCount:function(){},getFreeUploadedVideoCount:function(){},getFreeVideoLinkCount:function(){},validate:function(){},getOption:function(){},setOption:function(){},getTmpHash:function(){},setRedirectURL:function(){},startUpload:function(){},finishUpload:function(){},updateRestrictions:function(){}}),Gallery.Image.ImageGrid=Class.extend({_activeElement:-1,_baseInterval:3e3,_elements:[],_images:[],_intervalModifier:1,_isHover:!1,_pe:null,init:function(e,t){if(this._images=t,this._images.length<2)return void console.debug("[Gallery.Image.ImageGrid] At least two images are required but "+t.length+" are given, aborting.");var a=document.getElementById(e);if(null===!a)return void console.debug("[Gallery.Image.ImageGrid] Container '"+e+"' is missing, aborting.");this._initElements(a),this._pe=new WCF.PeriodicalExecuter(this.cycleImages.bind(this),this._baseInterval*this._intervalModifier),this._initEventListener(a)},_initElements:function(e){this._elements=[].slice.call(e.children);var t=document.createElement("a"),a=document.createElement("span");t.appendChild(a),this._elements[0].appendChild(t),this._elements[0].setAttribute("data-active-image",0),this._elements[0].setAttribute("data-image-index",0),this._elements[1]&&this._elements[1].setAttribute("data-image-index",3),this._elements[2]&&this._elements[2].setAttribute("data-image-index",7),2===this._elements.length?this._intervalModifier=1.5:1===this._elements.length&&(this._intervalModifier=2)},_initEventListener:function(e){e.addEventListener("mouseover",function(){this._isHover=!0}.bind(this)),e.addEventListener("mouseout",function(){this._isHover=!1}.bind(this));var t=this._elements.length,a=function(){var e=this._elements[0].offsetTop,a=1;t>1&&this._elements[1].offsetTop===e&&(a=2,3===t&&this._elements[2].offsetTop===e&&(a=3));var i=2;2===a?i=1.5:3===a&&(i=1),i!==this._intervalModifier&&(this._intervalModifier=i,this._pe.setInterval(this._baseInterval*this._intervalModifier))}.bind(this);a(),window.addEventListener("resize",a)},cycleImages:function(){if(!this._isHover){this._activeElement++,this._activeElement===this._elements.length&&(this._activeElement=0);var e=this._elements[this._activeElement];if(0===this._activeElement){var t=parseInt(e.getAttribute("data-image-index"))+1;t===this._images.length&&(t=0);var a=parseInt(e.getAttribute("data-active-image"))+1;2===a&&(a=0);var i=new Image;i.src=this._images[t].src;var n=e.children[a];n.setAttribute("href",this._images[t].url),n.classList.add("active"),n.children[0].style.setProperty("background-image","url("+this._images[t].src+")"),n.children[0].setAttribute("data-title",this._images[t].title),e.children[1===a?0:1].classList.remove("active"),e.setAttribute("data-active-image",a),e.setAttribute("data-image-index",t),i.complete?e.classList.add("hideLoading"):(e.classList.remove("hideLoading"),n.children[0].classList.add("imageLoading"),i.addEventListener("load",function(){e.classList.add("hideLoading"),n.children[0].classList.remove("imageLoading")}.bind(this)))}else{e.children.length>2&&e.removeChild(e.children[e.children.length-1]);var t=parseInt(e.getAttribute("data-image-index"))+1;t===this._images.length&&(t=0);var o=document.createElement("li");o.classList.add("imageGridItemOffset");var s=document.createElement("a");s.setAttribute("href",this._images[t].url),s.setAttribute("data-title",this._images[t].title),o.appendChild(s);var i=document.createElement("img");i.setAttribute("src",this._images[t].src),s.appendChild(i),e.insertBefore(o,this._elements[this._activeElement].children[0]),e.setAttribute("data-image-index",t),i.complete||(i.classList.add("imageLoading"),i.addEventListener("load",function(){i.classList.remove("imageLoading")})),setTimeout(function(){o.classList.remove("imageGridItemOffset")},10),e.offsetTop>this._elements[0].offsetTop&&setTimeout(this.cycleImages.bind(this),20)}}}}),Gallery.Image.ImagesInMotion=Class.extend({_container:null,_effectOptions:{},init:function(e,t,a){if(t.length<2)return void console.debug("[Gallery.Image.ImagesInMotion] At least two images are required but "+t.length+" are given, aborting.");if(this._container=$("#"+e),!this._container.length)return void console.debug("[Gallery.Image.ImagesInMotion] Container id '"+e+"' is invalid, aborting.");this._effectOptions=a||{},shuffle(t);for(var i=null,n=!1,o=0,s=t.length;o<s;o++)i=$('<img src="'+t[o].url+'" />').data("imageData",t[o]).appendTo(this._container),0===o&&(i.get(0).complete?n=!0:i.on("load",$.proxy(this._initKenBurnsEffect,this)));n&&this._initKenBurnsEffect()},_initKenBurnsEffect:function(){this._container.removeClass("loading").kenburns(this._effectOptions)}}),$.widget||($.widget=function(){}),$.widget("gallery.kenburns",{_activeCanvas:1,_animationIDs:[],_canvases:[],_caption:null,_current:{height:0,width:0,x:0,y:0},_images:[],_imageData:[],_index:-1,_link:null,_resumeAnimationCallbacks:[],_supportedAlignments:[],_updateCanvasDimensionsCallbacks:[],_userAvatar:null,options:{duration:7e3,randomizeZoom:!0,zoomFactor:.9},_create:function(){this._activeCanvas=1,this._animationIDs=[0,0],this._images=[],this._imageData=[],this._index=-1,this._resumeAnimationCallbacks=[null,null],this._updateCanvasDimensionsCallbacks=[null,null],this._supportedAlignments=["top","left","bottom","center","right"],this._canvases=[$('<canvas class="kenburns" />').appendTo(this.element).get(0),$('<canvas class="kenburns" />').appendTo(this.element).get(0)],this._link=$('<a class="box48"></a>').appendTo(this.element),this._userAvatar=$("<img />").addClass("userAvatarImage").appendTo(this._link),this._caption=$("<h1 />").appendTo(this._link),this.updateCanvasDimensions(),this.options.zoomFactor=Math.abs(this.options.zoomFactor),this.options.zoomFactor=Math.min(Math.max(this.options.zoomFactor,.5),1.5),this.element.children("img").each($.proxy(function(e,t){this._images.push(t),this._imageData.push($(t).data("imageData"))},this)),WCF.PageVisibilityHandler.addCallback("gallery.kenburns."+this.element.wcfIdentify().hashCode(),$.proxy(function(e){e?this.pause():this.resume()},this)),$(window).resize($.proxy(this.updateCanvasDimensions,this)),this.start()},updateCanvasDimensions:function(){var e=this.element.getDimensions("inner");this._canvases[0].height=e.height,this._canvases[0].width=e.width,this._canvases[1].height=e.height,this._canvases[1].width=e.width,this._updateCanvasDimensionsCallbacks[0]&&this._updateCanvasDimensionsCallbacks[0](),this._updateCanvasDimensionsCallbacks[1]&&this._updateCanvasDimensionsCallbacks[1]()},start:function(){var e=-1===this._index;this._index++,this._index===this._images.length&&(this._index=0),$(this._canvases[this._activeCanvas]).removeClass("primary").addClass("secondary"),this._activeCanvas=this._activeCanvas?0:1;var t=this._canvases[this._activeCanvas];$(t).addClass("primary").removeClass("secondary");var a=this._images[this._index];this._current=this.getCurrentImageDimensions(a,t);var i=this._imageData[this._index];this._caption.html(i.title),this._link.prop("href",i.link),this._userAvatar.prop("src",i.avatar),this._render(t,e)},getCurrentImageDimensions:function(e,t){var a={height:Math.floor(t.width/e.width*e.height),width:t.width,x:0,y:0};if(a.height<t.height){var i=t.height/a.height;a.height=t.height,a.width=t.width*i}return t.width<700&&(a.height*=2,a.width*=2),a.x=(a.width-t.width)/2*-1,a.y=(a.height-t.height)/2*-1,a},pause:function(){this._animationIDs[0]&&cancelAnimationFrame(this._animationIDs[0]),this._animationIDs[1]&&cancelAnimationFrame(this._animationIDs[1])},resume:function(){null!==this._resumeAnimationCallbacks[0]&&this._resumeAnimationCallbacks[0](),null!==this._resumeAnimationCallbacks[1]&&this._resumeAnimationCallbacks[1]()},_getAlignment:function(e,t,a,i,n,o,s){var r=0,l=0;switch(s){case"top":r=(n-a)/2*-1;break;case"left":l=(o-i)/2*-1;break;case"bottom":r=(n-a)/2*-1,l=-1*(o-i);break;case"right":r=-1*(n-a),l=(o-i)/2*-1;break;default:r=(n-a)/2*-1,l=(o-i)/2*-1}return{x:e+r,y:t+l}},_scaleImage:function(e,t,a){var i=Math.floor(e.width*t),n=Math.floor(e.height*t),o=this._getAlignment(e.x,e.y,e.width,e.height,i,n,a);return{height:n,width:i,x:o.x,y:o.y}},_render:function(e,t){function a(t){null===_&&(_=t),v&&(v=!1,_=t-m),m=t-_;var C=b._scaleImage(s,c,i),w=b._images[r];m<f?h=m/f:m>p?(h=(b.options.duration-m)/1e3,I||(I=!0,b.start())):h=1,o.clearRect(0,0,e.width,e.height),o.globalAlpha=h,o.drawImage(w,0,0,w.width,w.height,C.x,C.y,C.width,C.height),y=!1,l>1?(c=1+u*m)<g&&(y=!0):(c=d-u*m)>g&&(y=!0),y?b._animationIDs[n]=requestAnimationFrame(a):(b._resumeAnimationCallbacks[n]=null,b._updateCanvasDimensionsCallbacks[n]=null)}var i=this._supportedAlignments[Math.floor(Math.random()*this._supportedAlignments.length)],n=this._activeCanvas,o=e.getContext("2d"),s=this._current,r=this._index,l=this.options.zoomFactor;this.options.randomizeZoom&&Math.round(Math.random())&&(l=2-l),e.width<700&&(l<1?(l=1-l,l=1-2*l):(l=1-l,l=1+2*l));var c=1,u=0,d=1,g=l;g>1?u=Math.abs(l-1)/this.options.duration:(c=1-l+1,d=c,u=(1-l)/this.options.duration,g=1);var _=null,m=0,h=0,f=t?1e3:0,p=this.options.duration-1e3,I=!1,v=!1,y=!1,b=this;this._resumeAnimationCallbacks[n]=function(){v=!0,b._animationIDs[n]=requestAnimationFrame(a)},this._updateCanvasDimensionsCallbacks[n]=function(){s=b.getCurrentImageDimensions(b._images[r],e)},this._animationIDs[n]=requestAnimationFrame(a)}}),Gallery.Image.Share=WCF.Message.Share.Content.extend({_smallImageURL:"",_largeImageURL:"",_imageID:0,init:function(e,t,a){this._imageID=e,this._smallImageURL=t,this._largeImageURL=a,this._super()},_click:function(e){e.preventDefault();var t=$(e.currentTarget),a=t.prop("href"),i=a.hashCode();if(void 0===this._cache[i]){var n=!1;null===this._dialog?(this._dialog=$("<div />").hide().appendTo(document.body),n=!0):this._dialog.empty();var o=$('<section class="section"><h2 class="sectionTitle"><label for="__sharePermalink">'+WCF.Language.get("wcf.message.share.permalink")+"</label></h2></section>").appendTo(this._dialog);$('<input type="text" id="__sharePermalink" class="long" readonly />').attr("value",a).appendTo(o),this._smallImageURL?(o=$('<section class="section"><h2 class="sectionTitle"><label for="__shareSmallImageBBCode">'+WCF.Language.get("wcf.message.share.permalink.bbcode")+" ("+WCF.Language.get("gallery.image.share.smallImage")+")</label></h2></section>").appendTo(this._dialog),$('<input type="text" id="__shareSmallImageBBCode" class="long" readonly />').attr("value","[image='"+this._imageID+"',small][/image]").appendTo(o),o=$('<section class="section"><h2 class="sectionTitle"><label for="__shareLargeImageBBCode">'+WCF.Language.get("wcf.message.share.permalink.bbcode")+" ("+WCF.Language.get("gallery.image.share.largeImage")+")</label></h2></section>").appendTo(this._dialog),$('<input type="text" id="__shareLargeImageBBCode" class="long" readonly />').attr("value","[image='"+this._imageID+"',large][/image]").appendTo(o),o=$('<section class="section"><h2 class="sectionTitle"><label for="__shareSmallImageHTML">'+WCF.Language.get("wcf.message.share.permalink.html")+" ("+WCF.Language.get("gallery.image.share.smallImage")+")</label></h2></section>").appendTo(this._dialog),$('<input type="text" id="__shareSmallImageHTML" class="long" readonly />').attr("value",'<a href="'+a+'"><img src="'+this._smallImageURL+'" alt="" /></a>').appendTo(o),o=$('<section class="section"><h2 class="sectionTitle"><label for="__shareLargeImageHTML">'+WCF.Language.get("wcf.message.share.permalink.html")+" ("+WCF.Language.get("gallery.image.share.largeImage")+")</label></h2></section>").appendTo(this._dialog),$('<input type="text" id="__shareLargeImageHTML" class="long" readonly />').attr("value",'<a href="'+a+'"><img src="'+this._largeImageURL+'" alt="" /></a>').appendTo(o)):(o=$('<section class="section"><h2 class="sectionTitle"><label for="__shareImageBBCode">'+WCF.Language.get("wcf.message.share.permalink.bbcode")+"</label></h2></section>").appendTo(this._dialog),$('<input type="text" id="__shareImageBBCode" class="long" readonly />').attr("value","[url='"+a+"'][img]"+this._largeImageURL+"[/img][/url]").appendTo(o),o=$('<section class="section"><h2 class="sectionTitle"><label for="__shareImageHTML">'+WCF.Language.get("wcf.message.share.permalink.html")+"</label></h2></section>").appendTo(this._dialog),$('<input type="text" id="__shareImageHTML" class="long" readonly />').attr("value",'<a href="'+a+'"><img src="'+this._largeImageURL+'" alt="" /></a>').appendTo(o)),this._cache[i]=this._dialog.html(),n?this._dialog.wcfDialog({title:WCF.Language.get("wcf.message.share")}):this._dialog.wcfDialog("open")}else this._dialog.html(this._cache[i]).wcfDialog("open");this._enableSelection()}}),Gallery.Image.Slideshow={_didInit:!1,init:function(){this._didInit||(this._didInit=!0,this._domNodeInserted(),WCF.DOMNodeInsertedHandler.addCallback("Gallery.Image.Slideshow",$.proxy(this._domNodeInserted,this)))},_domNodeInserted:function(){$.browser.touch&&/[Mm]obile/.test(navigator.userAgent)&&!/iPad/.test(navigator.userAgent)?($(".jsGalleryAlbumImageViewer.button").hide(),$(".jsGalleryAlbumImageViewer").removeClass("jsGalleryAlbumImageViewer"),$(".jsGalleryCategoryImageViewer.button").hide(),$(".jsGalleryCategoryImageViewer").removeClass("jsGalleryCategoryImageViewer"),$(".jsGalleryUserImageViewer.button").hide(),$(".jsGalleryUserImageViewer").removeClass("jsGalleryUserImageViewer")):($(".jsGalleryAlbumImageViewer").removeClass("jsGalleryAlbumImageViewer").wcfImageViewer({className:"gallery\\data\\album\\AlbumAction"}),$(".jsGalleryCategoryImageViewer").removeClass("jsGalleryCategoryImageViewer").wcfImageViewer({className:"gallery\\data\\category\\GalleryCategoryAction"}),$(".jsGalleryUserImageViewer").removeClass("jsGalleryUserImageViewer").wcfImageViewer({className:"gallery\\data\\image\\ImageAction"}))}},Gallery.Image.Upload=WCF.Upload.Parallel.extend({_archiveUploadSuccess:{},_imageHandler:{},_listItems:{},_maxParallelUploads:0,_outstandingUploads:0,_quotaExceededError:{},_thumbnailGenerator:{},_tooManyImagesError:{},_visibleArchiveUploadSuccess:!1,_uploadRequests:[],init:function(){},_abortUpload:function(){},_createButton:function(){},_error:function(){},_getParameters:function(){},_getThumbnailGenerator:function(){},_insertButton:function(){},_initFile:function(){},_removeButton:function(){},_processUploadedImage:function(){},_processUploadedVideo:function(){},_sendRequest:function(){},_success:function(){},_upload:function(){},_setArchiveUploadSuccessHidden:function(){},hideUploadButton:function(){},showUploadButton:function(){},_sendRequest:function(){},_createUploadMatrix:function(){},_progress:function(){},_showOverlay:function(){},_evaluateResponse:function(){},_name:"",_buttonSelector:{},_fileListSelector:{},_fileUpload:{},_className:"",_iframe:{},_internalFileID:0,_options:{},_uploadMatrix:{},_supportsAJAXUpload:!0,_overlay:{},_getFilename:function(){}}),Gallery.Image.Processor=Class.extend({_imageHandler:{},_queue:{},_proxy:{},init:function(){},_sendRequest:function(){},_success:function(){},addImage:function(){},startProcessor:function(){}}),Gallery.Image.ThumbnailGenerator=Class.extend({generateThumbnails:function(){}}),Gallery.Image.Handler.Image=Class.extend({_createThumbnail:!1,_data:{},_errors:{},_imageID:0,_imageHandler:{},_removeImageIcon:{},_thumbnail:{},_thumbnailContainer:{},init:function(){},_addThumbnail:function(){},_editImage:function(){},addError:function(){},get:function(){},getData:function(){},getErrors:function(){},getImageID:function(){},getImageHandler:function(){},getThumbnail:function(){},getThumbnailContainer:function(){},getType:function(){},remove:function(){},removeThumbnail:function(){},set:function(){},setData:function(){},setErrors:function(){},setImageHandler:function(){},showTinyThumbnail:function(){},validate:function(){}}),Gallery.Image.Clipboard=Class.extend({_categoryID:0,_environment:"",_updateHandler:{},init:function(){},_clipboardAction:function(){},_moveToAlbum:function(){},_success:function(){}}),Gallery.Image.UpdateHandler=Class.extend({_images:{},init:function(){},update:function(){},_updateProperty:function(){},_handleCustomProperty:function(){},_delete:function(){},_deleteNote:function(){},_disable:function(){},_enable:function(){},_restore:function(){},_trash:function(){},getValue:function(){}}),Gallery.Image.UpdateHandler.ImageList=Gallery.Image.UpdateHandler.extend({_delete:function(){},_disable:function(){},_enable:function(){},_restore:function(){},_trash:function(){},_images:{},init:function(){},update:function(){},_updateProperty:function(){},_handleCustomProperty:function(){},_deleteNote:function(){},getValue:function(){}}),Gallery.Image.UpdateHandler.Image=Gallery.Image.UpdateHandler.extend({_delete:function(){},_deleteNote:function(){},_disable:function(){},_enable:function(){},_restore:function(){},_trash:function(){},_images:{},init:function(){},update:function(){},_updateProperty:function(){},_handleCustomProperty:function(){},getValue:function(){}}),Gallery.Image.DataHandler={},Gallery.Image.DataHandler.Base=Class.extend({_data:{},_imageHandler:{},_overwriteIcons:{},init:function(){},_overwriteData:function(){},_toggleOverwriteIcons:function(){},getData:function(){},getImageHandler:function(){},readData:function(){},setImageHandler:function(){},setInactive:function(){},updateData:function(){},validateData:function(){}}),Gallery.Image.DataHandler.Default=Gallery.Image.DataHandler.Base.extend({_categoryIDs:{},_categoryIDsError:{},_descriptionError:{},_maxDescriptionLength:0,_titleError:{},_useTitleAsFilename:null,init:function(){},_change:function(){},_getCategoryIDs:function(){},_hideCategoryIDsError:function(){},_hideDescriptionError:function(){},_hideTitleError:function(){},_needCategoriesOverwriteConfirmation:function(){},_needDescriptionOverwriteConfirmation:function(){},_needTitleOverwriteConfirmation:function(){},_overwriteCategories:function(){},_overwriteData:function(){},_overwriteDescription:function(){},_overwriteTitle:function(){},_setCategoryIDs:function(){},_setDescription:function(){},_setTitle:function(){},_showCategoryIDsError:function(){},_showDescriptionError:function(){},_showTitleError:function(){},readData:function(){},updateData:function(){},validateData:function(){},_data:{},_imageHandler:{},_overwriteIcons:{},_toggleOverwriteIcons:function(){},getData:function(){},getImageHandler:function(){},setImageHandler:function(){},setInactive:function(){}}),Gallery.Image.DataHandler.EnableComments=Gallery.Image.DataHandler.Base.extend({init:function(){},_click:function(){},_needOverwriteConfirmation:function(){},_overwriteData:function(){},_setEnableComments:function(){},readData:function(){},updateData:function(){},_data:{},_imageHandler:{},_overwriteIcons:{},_toggleOverwriteIcons:function(){},getData:function(){},getImageHandler:function(){},setImageHandler:function(){},setInactive:function(){},validateData:function(){}}),Gallery.Image.DataHandler.Album=Gallery.Image.DataHandler.Base.extend({_albumIDError:{},_albumIDs:{},_maxAlbums:0,_systemNotification:{},init:function(){},_addAlbum:function(){},_addNewAlbum:function(){},_click:function(){},_hideAlbumIDError:function(){},_needOverwriteConfirmation:function(){},_overwriteData:function(){},_setAlbumID:function(){},_showAlbumIDError:function(){},_toggleOverwriteIcons:function(){},readData:function(){},updateData:function(){},validateData:function(){},_data:{},_imageHandler:{},_overwriteIcons:{},getData:function(){},getImageHandler:function(){},setImageHandler:function(){},setInactive:function(){}}),Gallery.Image.DataHandler.Tagging=Gallery.Image.DataHandler.Base.extend({init:function(){},_click:function(){},_getTags:function(){},_needOverwriteConfirmation:function(){},_overwriteData:function(){},_setTags:function(){},readData:function(){},updateData:function(){},_data:{},_imageHandler:{},_overwriteIcons:{},_toggleOverwriteIcons:function(){},getData:function(){},getImageHandler:function(){},setImageHandler:function(){},setInactive:function(){},validateData:function(){}}),Gallery.Image.DataHandler.Location=Gallery.Image.DataHandler.Base.extend({_locationInput:{},_useCoordinates:{},_userLatitude:{},_userLongitude:{},init:function(){},_change:function(){},
_click:function(){},_initLocation:function(){},_needOverwriteConfirmation:function(){},_overwriteData:function(){},_setCoordinates:function(){},readData:function(){},setImageHandler:function(){},updateData:function(){},_data:{},_imageHandler:{},_overwriteIcons:{},_toggleOverwriteIcons:function(){},getData:function(){},getImageHandler:function(){},setInactive:function(){},validateData:function(){}}),Gallery.Image.DataHandler.VideoThumbnail=Gallery.Image.DataHandler.Base.extend({_container:null,_deleteButton:null,_thumbnail:null,_upload:null,init:function(){},_deleteThumbnail:function(){},_success:function(){},readData:function(){},setInactive:function(){},updateData:function(){},updateAfterUpload:function(){}}),Gallery.Image.PendingImageHandler=Class.extend({_imageHandler:{},init:function(){},_deleteImages:function(){},_loadImages:function(){},_success:function(){}}),Gallery.Image.ThumbnailAreaSelector=Class.extend({_button:{},_imageDimensions:{},_imageDiv:{},_imageHandler:{},_selection:{},init:function(){},_cancelSelection:function(){},_click:function(){},_resize:function(){},_saveArea:function(){},_updateSelection:function(){},refresh:function(){}}),Gallery.Image.Marker={},Gallery.Image.Marker.Editor=Gallery.Image.DataHandler.Base.extend({_disableAdding:!1,_dialog:{},_markers:{},_markerHeight:0,_markerWidth:0,init:function(){},_addMarker:function(){},_addMarkerByData:function(){},_changeMarkerType:function(){},_convertClickPositionToDisplayPosition:function(){},_convertDisplayPositionToSavePosition:function(){},_convertSavePositionToDisplayPosition:function(){},_createDialog:function(){},_createMarker:function(){},_deleteMarker:function(){},_dragStart:function(){},_dragStop:function(){},_getMarkerHeight:function(){},_getMarkerWidth:function(){},_removeMarker:function(){},_refreshMarkerPositions:function(){},_rotateMarkers:function(){},_saveMarker:function(){},_setMarkerDimensions:function(){},_showDialog:function(){},_success:function(){},_updateMarkerPosition:function(){},_validateData:function(){},getData:function(){},getMarkers:function(){},getMarkersData:function(){},setMarkers:function(){},updateData:function(){},_data:{},_imageHandler:{},_overwriteIcons:{},_overwriteData:function(){},_toggleOverwriteIcons:function(){},getImageHandler:function(){},readData:function(){},setImageHandler:function(){},validateData:function(){}}),Gallery.Image.Marker.Handler=Class.extend({_image:null,_imageContainer:null,_imageHeight:0,_imageWidth:0,_markers:[],init:function(e,t,a){this._markers=e,this._imageWidth=t,this._imageHeight=a,this._imageContainer=$(".galleryImage"),this._image=this._imageContainer.find("> a > img").eq(0),this._image.width()?this._addMarkers():this._image.on("load",$.proxy(this._addMarkers,this)),$(window).resize($.proxy(this.refreshMarkerPositions,this)),$.browser.touch?$(".galleryImageMarker").click($.proxy(this._showDialog.bind(this))):$(".jsGalleryImageMarkedUser").hover($.proxy(this._highlightMarkedUser,this))},_addMarkers:function(){this._image.off("load",$.proxy(this._addMarkers,this));for(var e=0,t=this._markers.length;e<t;e++){var a=this._markers[e];a.userID?this._addUserMarker(a):this._addTextMarker(a)}},_addTextMarker:function(e){var t=$('<span class="galleryImageMarker galleryImageTextMarker" />').data(e);this._imageContainer.append(t),this._setMarkerPosition(t)},_addUserMarker:function(e){var t=$('<span class="galleryImageMarker galleryImageUserMarker userLink" />').data(e);t.attr("data-user-id",e["user-id"]),this._imageContainer.append(t),this._setMarkerPosition(t)},_highlightMarkedUser:function(e){var t=$(e.currentTarget).data("userID");this._imageContainer.children(".galleryImageMarker").each(function(e,a){var i=$(a);i.data("userID")==t&&i.toggleClass("jsMarked")})},_setMarkerPosition:function(e){e.css({left:parseInt(this._image.position().left+e.data("positionX")*this._image.width()/this._imageWidth-e.outerWidth()/2),top:parseInt(e.data("positionY")*this._image.height()/this._imageHeight-e.outerHeight()/2)})},_showDialog:function(e){var t=$(e.currentTarget);t.hasClass("galleryImageUserMarker")?require(["Ajax","Language","Ui/Dialog"],function(e,a,i){var n="imageMarker"+t.data("markerID");i.getDialog(n)?i.openStatic(n):e.apiOnce({data:{actionName:"getUserProfile",className:"wcf\\data\\user\\UserProfileAction",objectIDs:[t.data("userID")]},success:function(e){i.openStatic(n,e.returnValues.template,{title:a.get("gallery.image.marker")})}})}):require(["Language","Ui/Dialog"],function(e,a){a.openStatic("imageMarker"+t.data("markerID"),t.data("description"),{title:e.get("gallery.image.marker")})})},refreshMarkerPositions:function(){this._imageContainer.children(".galleryImageMarker").each($.proxy(function(e,t){this._setMarkerPosition($(t))},this))}}),Gallery.Image.Marker.TextPopover=WCF.Popover.extend({init:function(){this._super(".galleryImageTextMarker")},_loadContent:function(){var e=$("#"+this._activeElementID);this._insertContent(this._activeElementID,e.data("description"),!0)}}),Gallery.Map={},Gallery.Map.LargeMap=WCF.Location.GoogleMaps.LargeMap.extend({init:function(e,t,a,i,n){t||(t={}),t.stringifyExcludedObjectIds=!0,this._super(e,t,a,i,n)},_success:function(e,t,a){if(e.returnValues&&e.returnValues.markers)for(var i=0,n=e.returnValues.markers.length;i<n;i++){var o=e.returnValues.markers[i];this.addMarker(o.latitude,o.longitude,o.title,null,o.infoWindow,o.dialog,o.location),o.objectID?this._objectIDs.push(o.objectID):o.objectIDs&&(this._objectIDs=this._objectIDs.concat(o.objectIDs))}},addMarker:function(e,t,a,i,n,o,s){var r=$(n).get(0),l=this._super(e,t,a,i,r);return o&&google.maps.event.addListener(l.infoWindow,"domready",$.proxy(function(){new Gallery.Map.InfoWindowImageListDialog($(r).find(".jsGalleryLocationDialogImageListButton"),o,s)},this)),l.infoWindow}}),Gallery.Map.InfoWindowImageListDialog=Class.extend({_dialog:null,_dialogContent:"",_imageData:[],init:function(e,t,a){this._dialogContent=t,this._location=a,e.click($.proxy(this._click,this))},_click:function(){null===this._dialog?this._dialog=$("<div />").append(this._dialogContent).hide().appendTo(document.body).wcfDialog({title:WCF.Language.get(this._location)}):this._dialog.wcfDialog("open")}});